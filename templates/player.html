{% extends "base.html" %}
{% block title %}flock - crowd-sourced music discovery{% endblock %}
{% block head %}{{ super() }}{% endblock %}
{% block content %}
	<div class="container">
		<a href="/" class="black"><h1 class="flock">flock</h1><span class="beta-stamp">beta</span></a>
		<form action="/" method="get" id="mainForm">
			<!-- Subreddits: <input type="text" name="subreddits" value="{{subreddits}}" />
			<button type="submit" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-play"></span> Play </button>
			<span>{{error}}</span> -->
			<div class="row">
				<div class="col-lg-12">
					<div class="input-group">
						<select data-placeholder="subreddit subreddit subreddit" class="chosen-select form-control" multiple tabindex="4">
							<option value=""></option>
							{% for subreddit in subreddit_list %}
								<option value="{{subreddit}}" {% if subreddit|lower in selected_subreddits|map('lower') %} selected {% endif %}>{{subreddit}}</option>
							{% endfor %}
						</select>
						<input type="hidden" name="subreddits" value="{{selected_subreddits|join(' ')}}" id="subredditsParam" />
				      	<!-- <input type="text" placeholder="subreddit subreddit subreddit" class="form-control" name="subreddits" value="{{subreddits}}" /> -->
				      	<span class="input-group-btn">
					        <button type="submit" class="btn btn-default" style="height:42px;"><span class="glyphicon glyphicon-play"></span> Play </button>
					    </span>
				    </div><!-- /input-group -->
		    	</div><!-- /.col-lg-6 -->
			</div><!-- /.row -->
			{% with errors = get_flashed_messages(category_filter=["error"]) %}
				{% if errors %}
					<div class="errors">
						{% for error in errors %}
							<div class="alert alert-danger">
								<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
								<strong>Error!</strong> {{error}}
							</div>
						{% endfor %}
					</div>
				{% endif %}
			{% endwith %}
		</form>
		<br/>

		{% if links %}
			<ul class="nav nav-pills sort-nav">
				<li {% if sort == "hot" %} class='active' {% endif %}><a href="javascript:void(0);" onclick="addArg(['sort'], ['hot'])">Hot</a></li>
				<li class="dropdown {% if sort == "top" %} active {% endif %}">
				    <a class="dropdown-toggle" data-toggle="dropdown" href="javascript:void(0);">
				    	Top
				    	{% if sort == "top" %}
				    		&nbsp;-&nbsp;
					      	{% if time == 'day' %} 
					      		today 
				      		{% elif time == 'all' %} 
				      			all-time 
			      			{% else %} 
			      				this {{ time }} 
			      			{% endif %}
		      			{% endif %}
	      				<span class="caret"></span>
				    </a>
				    <ul class="dropdown-menu">
						<li {% if time == "day" %} class='active' {% endif %}><a href="javascript:void(0);" onclick="addArg(['t', 'sort'], ['day', 'top'])">today</a></li>
				      	<li {% if time == "week" and sort == 'top' %} class='active' {% endif %}><a href="javascript:void(0);" onclick="addArg(['t', 'sort'], ['week', 'top'])">this week</a></li>
				      	<li {% if time == "month" %} class='active' {% endif %}><a href="javascript:void(0);" onclick="addArg(['t', 'sort'], ['month', 'top'])">this month</a></li>
				      	<li {% if time == "year" %} class='active' {% endif %}><a href="javascript:void(0);" onclick="addArg(['t', 'sort'], ['year', 'top'])">this year</a></li>
				      	<li {% if time == "all" %} class='active' {% endif %}><a href="javascript:void(0);" onclick="addArg(['t', 'sort'], ['all', 'top'])">all-time</a></li>
				    </ul>
			  	</li>
			</ul>

			<br>

			<iframe id="player" class="player" type="text/html" width="640" height="360" src="{{youtube_url}}" frameborder="0" allowfullscreen></iframe>

			<br>

			<!-- The list of tracks and such -->
			<table class="table table-striped">
				<tbody>
					{% for link in links %}
						<tr class="track" data-playnum="{{ loop.index0 }}">
							<td class="playNumber playTrack">
								<span class="playNum">{{ loop.index }}</span>
								<span class="glyphicon glyphicon-play grey playIcon"></span>
								<span class="glyphicon glyphicon-volume-down nowPlayingIcon"></span>
							</td>
							<td class="playTrack">
								<span class="playTitle">{{ link.get("title") }}</span>
								<span class="comments">
									<a class="commentNum" target="_blank" href="{{ link.get("permalink") }}">
								
										<span class="glyphicon glyphicon-comment"></span>
										{{link.get("num_comments")}}</a>
									</a>
								</span>
							</td>
							<td class="">
								<span class="youtube">
									<a class="italic permalink" target="_blank" href="{{ link.get("url") }}">
										<span class="glyphicon glyphicon-film"></span>
										YouTube
									</a>
								</span>
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		{% endif %}
	</div>
{% endblock content %}
{% block footer %}{{ super() }}{% endblock %}